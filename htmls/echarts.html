<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>环保统计图</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<style>
		.chart {
				height: 400px;
			}
		
		</style>
	</head>

	<body>
		<div style="margin-bottom: 10px;margin-left: 10px;">
			<span id="update_time" style="font-size:12px"></span>
		</div>
		<div class="chart" id="gaugeChart"></div>
		<script src="js/echarts.min.js"></script>
		<script type="text/javascript" src="js/jquery.js"></script>
		<script>
			var Point_Type_ZOOLGY = 0;
			var Point_Type_RESIDENT = 1;
			var Point_Type_HOUSE = 2;
			//业务类型审批等， 全部类型
			//"未提交", 1
			//"待审批",2
			//"审批驳回",3
			//"审批通过",4
			//"审核新增"5
			var procedureType = 0
			var selectSection = -1;
			var byId = function(id) {
				return document.getElementById(id);
			};
			var gaugeChart = echarts.init(byId('gaugeChart'));
			
			//http://127.0.0.1:8020/hpsb/echarts.html?SensitiveType=2&procedure=0&selSection=-1
			var SensitiveType = getUrlParam("SensitiveType");
			var procedure = getUrlParam("procedure");
			var selSection = getUrlParam("selSection");
			
			filterData(SensitiveType==null?0:SensitiveType,
				procedure==null?0:procedure,
				selSection==null?-1:selSection);

			function filterData(SensitiveType, procedure, selSection) {
				gaugeChart.showLoading();
				procedureType = procedure;
				selectSection = selSection;
				if(SensitiveType == Point_Type_ZOOLGY) {
					jQuery.getJSON("data/echart_zoolgy.js", callbackData);
				} else if(SensitiveType == Point_Type_RESIDENT) {
					jQuery.getJSON("data/echart_resident.js", callbackData);
				} else if(SensitiveType == Point_Type_HOUSE) {
					jQuery.getJSON("data/echart_house.js", callbackData);
				}

			}

			function callbackData(data) {
				gaugeChart.hideLoading();
				var result = data;
				var legends = [];
				var sections = result.sections;
				if(selectSection != -1) {
					sections = [];
					sections[0] = result.sections[selectSection];
				}
				var selectedMode = false;
				var serieslist = [];
				var colors = ['#f4b01f', '#72a4ee', '#c60000', '#67ba35', '#149fab'];
				var i = 0;
				var cnt = result.legend.length;
				if(procedureType != 0) {
					i = procedureType - 1;
					cnt = i + 1;
				}
				else
				{
					selectedMode = true;
				}
				var index = 0;
				for(; i < cnt; i++) {

					legends[index] = result.legend[i];
					var selectData = result.series[i].data;
					if(selectSection != -1) {
						selectData = [];
						selectData[0] = result.series[i].data[selectSection];
					}
					var series = {
						name: result.legend[i],
						type: 'bar',
						itemStyle: {
							normal: {
								color: colors[i]
							}
						},
						stack: '总量',
						label: {
							normal: {
								show: true,
								position: 'insideRight'
							}
						},
						data: selectData
					};
					serieslist[index] = series;
					index++;
				}

				var chartOption = {
					tooltip: {
						trigger: 'axis',
						axisPointer: { // 坐标轴指示器，坐标轴触发有效
							type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
						}
					},
					legend: {
						selectedMode:selectedMode,
						data: legends
					},
					grid: {
						left: '1%',
						right: '4%',
						bottom: '1%',
						containLabel: true
					},
					xAxis: {
						type: 'value'
					},
					yAxis: {
						type: 'category',
						data: sections
					},
					series: serieslist
				};
				gaugeChart.clear();
				gaugeChart.setOption(chartOption);

				//					gaugeChart.on("legendselectchanged", function(params) {
				//						var isSelected = params.selected[params.name];
				//						// 在控制台中打印
				//						console.log((isSelected ? '选中了' : '取消选中了') + '图例' + params.name);
				//						// 打印所有图例的状态
				//						console.log(params.selected);
				//					});

				var dateNow = new Date();
				var dateStr = "截止时间：" + dateNow.Format('yyyy-MM-dd hh:mm:ss');
				byId('update_time').innerText = dateStr;

			}

			Date.prototype.Format = function(fmt) {
					var o = {
						"M+": this.getMonth() + 1, //月份 
						"d+": this.getDate(), //日 
						"h+": this.getHours(), //小时 
						"m+": this.getMinutes(), //分 
						"s+": this.getSeconds(), //秒 
						"q+": Math.floor((this.getMonth() + 3) / 3), //季度 
						"S": this.getMilliseconds() //毫秒 
					};
					if(/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
					for(var k in o)
						if(new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
					return fmt;
				}
				//给手机调用
			function getSections(sections) {
				if(window.androidECharts != null) {
					window.androidECharts.ReceiveSections(JSON.stringify(sections));
				}
			}
		  function getUrlParam(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if(r != null) return unescape(r[2]);
                return null;
            }
		</script>
	</body>

</html>